Делаем игру квест GhostBuster

0. Общая концепция

Платформа: iOS, iPhone only.

Технологии: Swift, SwiftUI для UI, ARKit + RealityKit для AR, CoreLocation + Compass (CLLocationManager + heading), MapKit для карты.

Игра = набор “игр-сценариев” (Game).

В каждой игре:

карта с набором окружностей-зон (location layout),

список призраков с параметрами (имя, модель, радиусы, время удержания и т.д.).

Режимы игрока:

Сканер/компас (поиск по GPS/heading).

AR-поиск (в пределах основной зоны).

Бой (в ближнем радиусе + ловушка).

1. Модель данных
1.1. Игра (Game)

Поля:

id: UUID

name: String — название сценария/игры.

locationLayout: [CircleZone] — список окружностей, задающих игровую локацию; могут пересекаться.

ghosts: [Ghost] — список призраков.

Статус:

isActive: Bool — “выбранная” игра для режима охоты.

Дополнительно можно хранить прогресс: число пойманных/всего.

1.2. Окружность локации (CircleZone)

Определяет, где в парке “игровая зона” (редактор).

Поля:

id: UUID

centerLatitude: Double

centerLongitude: Double

radiusMeters: Double (например 50–200 м).

1.3. Призрак (Ghost)

Поля конфигурации:

id: UUID

name: String — имя призрака.

modelID: String — идентификатор 3D/2D-модели (например имя ассета в проекте).

baseLocation: CLLocationCoordinate2D — точка привязки призрака (можно выбирать тапом по карте внутри layout).

mainZoneRadius: Double — основной радиус срабатывания AR (100–200 м, настраивается).

fightRadius: Double — радиус боя (10–30 м).

trapWindowDuration: TimeInterval — время окна для броска ловушки (5–10 секунд).

escapeDistanceMeters: Double — радиус, на который призрак “отлетает”, если вырвался (30–50 м, настраивается).

Текущее состояние:

state: GhostState — см. ниже.

currentPosition: CLLocationCoordinate2D — текущая позиция (может отличаться от baseLocation после “отлёта”).

lastEscapeDate: Date? (опционально).

1.4. Статус призрака (GhostState)
enum GhostState {
    idle        // не пойман, на свободе
    active      // выбран текущей целью (в пределах игры, ещё не в AR)
    arSearch    // активен AR-поиск, игрок в основной зоне
    fight       // игрок в радиусе боя
    trapWindow  // пойман, открыто окно для броска ловушки
    escaped     // вырвался и отлетел на escapeDistance
    captured    // пойман окончательно
}

2. Хранение и загрузка

Все игры и их состояние хранятся локально на устройстве.

Формат: JSON.

Структура:

games.json — список всех игр (Game), включая состояния призраков.

Операции:

Создать игру.

Редактировать (добавлять/удалять CircleZone и Ghost).

Сохранить изменения.

Удалить игру.

Выбрать “активную” игру для режима охоты.

3. Экран 1: Список игр
3.1. Функция экрана

Показывает список всех сохранённых игр (карта + призраки).

Позволяет:

выбрать игру для редактирования,

выбрать игру для запуска в режиме охоты,

создать новую игру (кнопка “+”),

удалить игру.

3.2. Элементы UI

Тайтл: “Игры” или “Сценарии”.

Список:

строки вида:

Название игры

подзаголовок: Поймано X / Y призраков или “Новая игра (0 призраков)”.

Кнопки:

+ — создать новую игру:

открывает экран настройки игры (Экран 2) с пустым layout и пустым списком призраков.

По тапу по строке:

открывается Экран 2 (настройка выбранной игры).

Контекстное действие:

“Играть” — запускает режим охоты с выбранной игрой (Экран охоты: сканер).

“Удалить”.

4. Экран 2: Настройка игры (карта + список призраков)
4.1. Функция экрана

Редактирование конкретной игры:

Разметка локации как нескольких окружностей на карте.

Управление списком призраков.

4.2. Элементы UI

Верхняя часть: карта (MapKit).

На карте:

отображаются все CircleZone как полупрозрачные окружности.

Действия на карте:

Тап/long-tap по карте → добавить новую окружность:

центр = точка тап-а,

радиус по умолчанию (например 100 м).

При выборе окружности:

можно:

изменить радиус (слайдер/stepper),

удалить (кнопка).

Нижняя часть: список призраков в этой игре:

Каждая строка:

Имя призрака + краткая инфа (например mainRadius, fightRadius).

Кнопки:

Добавить призрака → Экран 3 (новый Ghost).

Тап по призраку → Экран 3 (редактирование Ghost).

Кнопка “Готово/Назад” — сохраняет изменения в JSON.

5. Экран 3: Настройка призрака
5.1. Функция экрана

Редактирование одного Ghost:

его локации,

имени,

модели,

расстояний и таймингов.

5.2. Элементы UI

Поля:

Имя (TextField).

Модель (Picker / TextField для ID ассета).

Карта:

показывает layout игры (CircleZone).

отдельный маркер “точка базовой позиции призрака”.

Тап по карте → задаём baseLocation для призрака (центр зоны появления).

Параметры расстояний и времени:

Основная зона (mainZoneRadius) — слайдер/stepper, диапазон 100–200 м.

Радиус боя (fightRadius) — слайдер/stepper, диапазон 10–30 м.

Окно ловушки (trapWindowDuration) — слайдер/stepper, диапазон 5–10 сек.

Радиус отлёта (escapeDistanceMeters) — слайдер/stepper, диапазон 30–50 м.

Кнопки:

“Сохранить” — обновляет/создаёт призрака в игре.

“Удалить призрака” (если редактирование существующего).

6. Игровой режим: состояния и экраны

Игровой режим оперирует одной выбранной игрой.

6.1. Общая логика

Есть активная игра Game.

У призраков могут быть состояния:

captured — пойманы, в поиске не участвуют.

остальное — участвуют.

Игра отслеживает:

текущую позицию игрока (GPS),

направление устройства (компас),

текущего “цель-призрака” (target).

6.2. Этап 1: Сканер / компас
Задача

Игрок ходит по парку, телефон показывает, куда бежать, чтобы выйти на ближайшего не пойманного призрака.

Логика

Для всех ghosts с state != captured:

считаем расстояние от текущей позиции.

Выбираем ближайшего (target).

Показываем:

стрелку (компас) в направлении target.currentPosition,

расстояние до target.

Если расстояние до target ≤ mainZoneRadius этого призрака:

появляется кнопка “AR-поиск” (перейти в AR-режим).

UI

Центральный круг/стрелка (компас).

Подпись:

Призрак: Имя

Расстояние: XXX м.

При входе в mainZoneRadius:

кнопка “Запустить AR-поиск”.

6.3. Этап 2: AR-поиск
Задача

Когда игрок в основной зоне (100–200 м), запускается AR-режим:

призрак появляется в AR (на фиксированном расстоянии),

на экране видны “следы”/подсказки.

Логика

При входе в AR:

ghost.state = arSearch.

На AR-сцене появляется визуальный “призрак” (модель modelID) на некотором расстоянии вперёд (в пределах логики ARKit).

Параллельно продолжаем отслеживать расстояние по GPS:

если расстояние ≤ fightRadius (10–30 м):

переходим в этап 3 (бой).

Игрок может выйти из AR и вернуться в сканер:

кнопка “Назад к сканеру”.

UI

Камера + AR-призрак.

2D-оверлеи:

крест/прицел в центре.

“следы” или “луч” в сторону призрака (простые визуальные эффекты).

6.4. Этап 3: Бой (удержание / попадание)
Задача

Игрок в радиусе боя (10–30 м).

Надо “поймать” призрака:

либо удержанием в прицеле N секунд,

либо попаданием по нему (тап/луч).

Параметр

holdTime = trapTriggerHold (можно привязать к fightRadius или добавить отдельное поле, если нужно; сейчас достаточно использовать fightRadius + логика “удержание прицела”).

Логика

При достижении fightRadius:

ghost.state = fight.

В AR:

считаем “наведён ли прицел на призрака”.

если в центре экрана призрак удерживается, например, 2 секунды:

считаем призрака “пойманным”,

ghost.state = trapWindow.

переходим к этапу 4 (окно ловушки).

UI

Прицел в центре.

Полоса прогресса удержания:

растёт, пока призрак в центре,

сбрасывается, если ушёл.

6.5. Этап 4: Окно для ловушки
Задача

После “попадания” по призраку появляется окно (overlay) на trapWindowDuration секунд (5–10 сек):

большая кнопка “Бросить ловушку”.

Если игрок успел нажать → победа.

Если нет → призрак вырывается и отлетает на escapeDistanceMeters.

Логика

При входе в состояние trapWindow:

запускается таймер trapWindowDuration.

Если нажата кнопка:

анимация “бросок ловушки” (AR),

ghost.state = captured,

игра обновляет прогресс.

Если таймер истёк:

анимация “призрак вырвался и улетел”,

смещаем ghost.currentPosition от currentPosition на дистанцию escapeDistanceMeters в случайном направлении,

ghost.state = escaped или idle (снова доступен для поиска).

Возврат в сканер:

после завершения анимаций.

UI

Overlay поверх AR:

текст: “Бросай ловушку!”

таймер обратного отсчёта (секунды).

кнопка “Бросить”.

7. Требования к состояниям и прогрессу

При запуске игры:

все призраки, у которых state != captured, считаются доступными для охоты.

Для списка игр:

показывать прогресс: capturedCount / totalCount.

Возможность сбросить прогресс:

кнопка “Сбросить прогресс” для игры:

у всех призраков state → idle,

currentPosition = baseLocation.

8. Дополнительные требования

Игра работает офлайн (без интернета).

Если GPS/компас временно недоступны:

вывести сообщение об ошибке,

не падать.

При отсутствии активной игры:

экран охоты недоступен, предлагается выбрать/создать игру.

Если хочешь, следующим шагом могу:

превратить это ТЗ в конкретную структуру модулей/файлов Swift (перечень View, ViewModel, Model),

или сразу накидать модели (Game, Ghost, GhostState) и прототип навигации между тремя редакторскими экранами + заглушкой “Сканер/AR”.